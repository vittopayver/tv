<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>Player IPTV</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Roboto', 'Segoe UI', Arial, sans-serif;
            -webkit-tap-highlight-color: transparent;
        }
        
        html, body {
            background: #0f0f0f;
            color: #f1f1f1;
            overflow: hidden;
            height: 100vh;
            height: 100dvh;
            position: fixed;
            width: 100%;
            transition: background-color 0.3s ease, color 0.3s ease;
            overscroll-behavior: none;
            -webkit-overflow-scrolling: touch;
        }
        
        body.light-theme {
            background: #ffffff;
            color: #0f0f0f;
        }
        
        body.light-theme .player-container {
            background: #ffffff;
        }
        
        body.light-theme .channels-section {
            background: #f5f5f5;
        }
        
        body.light-theme .channel-item {
            border-left: 3px solid transparent;
        }
        
        body.light-theme .channel-item:hover {
            background: #e8e8e8;
        }
        
        body.light-theme .channel-item.active {
            background: #e8e8e8;
            border-left-color: #a000ff;
        }
        
        body.light-theme .channel-thumbnail {
            background: linear-gradient(135deg, #a000ff, #2d5bff);
        }
        
        body.light-theme .channel-name {
            color: #0f0f0f;
        }
        
        body.light-theme .channel-category,
        body.light-theme .live-indicator {
            color: #606060;
        }
        
        body.light-theme .info-text {
            background: #ffffff;
            color: #606060;
        }
        
        body.light-theme .chat-drawer {
            background: #f5f5f5;
        }
        
        body.light-theme .chat-header {
            background: #ffffff;
            border-bottom: 1px solid #e0e0e0;
        }
        
        body.light-theme .chat-title {
            background: linear-gradient(135deg, #a000ff, #2d5bff);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        body.light-theme .chat-close-btn {
            color: #606060;
        }
        
        body.light-theme .chat-close-btn:hover {
            background: rgba(0, 0, 0, 0.05);
        }
        
        body.light-theme .chat-header::before {
            background: #d0d0d0;
        }
        
        body.light-theme .chat-unavailable-title {
            color: #0f0f0f;
        }
        
        body.light-theme .chat-unavailable-text {
            color: #606060;
        }
        
        body.light-theme .loading,
        body.light-theme .error {
            color: #606060;
        }
        
        body.light-theme .error {
            color: #a000ff;
        }
        
        body.light-theme ::-webkit-scrollbar-track {
            background: #f5f5f5;
        }
        
        body.light-theme ::-webkit-scrollbar-thumb {
            background: #c0c0c0;
        }
        
        body.light-theme ::-webkit-scrollbar-thumb:hover {
            background: #a0a0a0;
        }
        
        body.light-theme .browser-block {
            background: #ffffff;
        }
        
        body.light-theme .browser-block-title {
            color: #0f0f0f;
        }
        
        body.light-theme .browser-block-message {
            color: #606060;
        }
        
        .player-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            height: 100dvh;
            background: #0f0f0f;
            display: flex;
            flex-direction: column;
        }

        .video-wrapper {
            position: relative;
            width: 100%;
            padding-top: 56.25%;
            background: #000;
            overflow: visible;
            flex-shrink: 0;
        }

        #video-player {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            object-fit: contain;
            background: #000;
            display: block;
        }

        .video-wrapper.transitioning {
            visibility: hidden;
        }

        .progress-divider {
            width: 100%;
            height: 2px;
            background: linear-gradient(to right, #a000ff, #2d5bff);
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            z-index: 10;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .progress-divider.show {
            opacity: 1;
        }

        .progress-divider-fill {
            position: absolute;
            top: 0;
            left: 0;
            height: 100%;
            width: 0%;
            background: linear-gradient(to right, #a000ff, #2d5bff);
            transition: width 0.1s linear;
            position: relative;
        }

        .progress-divider-ball {
            position: absolute;
            top: 50%;
            right: 0;
            transform: translateY(-50%);
            width: 10px;
            height: 10px;
            background: #2d5bff;
            border-radius: 50%;
            box-shadow: 0 0 4px rgba(0,0,0,0.3);
        }

        body.is-landscape .channels-section {
            display: none !important;
        }

        body.is-landscape .progress-divider {
            display: none !important;
        }

        body.is-landscape .info-text {
            display: none !important;
        }

        body.is-landscape .chat-btn {
            display: none !important;
        }
        
        .click-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 3;
        }
        
        .video-header {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            background: linear-gradient(to bottom, rgba(0,0,0,0.7), transparent);
            padding: 12px 16px;
            z-index: 6;
            display: flex;
            align-items: center;
            gap: 12px;
            opacity: 0;
            transition: opacity 0.3s ease;
            pointer-events: none;
        }
        
        .video-header.show {
            opacity: 1;
            pointer-events: all;
        }
        
        .video-title {
            flex: 1;
            font-size: 16px;
            font-weight: 400;
            color: white;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }
        
        .chat-btn {
            background: rgba(255, 255, 255, 0.1);
            border: none;
            color: white;
            padding: 10px;
            border-radius: 50%;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            width: 40px;
            height: 40px;
            transition: background 0.2s;
        }
        
        .chat-btn:hover {
            background: rgba(255, 255, 255, 0.15);
        }
        
        .chat-btn:active {
            transform: scale(0.95);
        }
        
        .chat-btn svg {
            width: 20px;
            height: 20px;
        }
        
        .player-container.fullscreen .chat-btn {
            display: none !important;
        }
        
        .chat-drawer {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            height: 56vh;
            background: #1a1a1a;
            transform: translateY(100%);
            transition: transform 0.3s ease, height 0.3s ease;
            z-index: 1000;
            display: flex;
            flex-direction: column;
            border-top-left-radius: 10px;
            border-top-right-radius: 10px;
            box-shadow: 0 -4px 12px rgba(0,0,0,0.3);
            touch-action: none;
        }
        
        .chat-drawer.open {
            transform: translateY(0);
        }
        
        .chat-drawer.expanded {
            height: calc(100vh - 90px);
            border-top-left-radius: 10px;
            border-top-right-radius: 10px;
        }
        
        .chat-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 16px 20px;
            border-bottom: 1px solid #2a2a2a;
            background: #1f1f1f;
            border-top-left-radius: 10px;
            border-top-right-radius: 10px;
            cursor: grab;
            position: relative;
        }
        
        .chat-drawer.expanded .chat-header {
            border-top-left-radius: 10px;
            border-top-right-radius: 10px;
        }
        
        .chat-header:active {
            cursor: grabbing;
        }
        
        .chat-header::before {
            content: '';
            position: absolute;
            top: 8px;
            left: 50%;
            transform: translateX(-50%);
            width: 40px;
            height: 4px;
            background: #444;
            border-radius: 2px;
        }
        
        .chat-title {
            font-size: 18px;
            font-weight: 600;
            background: linear-gradient(135deg, #a000ff, #2d5bff);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-top: 8px;
        }
        
        .chat-close-btn {
            background: none;
            border: none;
            color: #aaa;
            font-size: 32px;
            cursor: pointer;
            padding: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            transition: background 0.2s;
            line-height: 1;
            margin-top: 8px;
        }
        
        .chat-close-btn:hover {
            background: rgba(255, 255, 255, 0.1);
        }
        
        .chat-close-btn:active {
            transform: scale(0.9);
        }
        
        .chat-content {
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 32px;
            overflow-y: auto;
        }
        
        .chat-unavailable {
            text-align: center;
            color: #aaa;
        }
        
        .chat-unavailable-icon {
            font-size: 48px;
            margin-bottom: 16px;
            opacity: 0.5;
        }
        
        .chat-unavailable-title {
            font-size: 18px;
            font-weight: 600;
            color: #f1f1f1;
            margin-bottom: 8px;
        }
        
        .chat-unavailable-text {
            font-size: 14px;
            color: #888;
        }
        
        .video-controls {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: linear-gradient(to top, rgba(0,0,0,0.8), transparent);
            padding: 40px 16px 12px;
            z-index: 6;
            opacity: 0;
            transition: opacity 0.3s ease;
            pointer-events: none;
        }
        
        .video-controls.show {
            opacity: 1;
            pointer-events: all;
        }
        
        .controls-row {
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .control-btn {
            background: none;
            border: none;
            color: white;
            font-size: 20px;
            cursor: pointer;
            padding: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: transform 0.1s;
        }
        
        .control-btn:active {
            transform: scale(0.9);
        }
        
        .spacer {
            flex: 1;
        }
        
        .live-badge {
            background: transparent;
            color: white;
            padding: 2px 6px;
            border-radius: 3px;
            font-size: 12px;
            font-weight: 500;
            letter-spacing: 0.5px;
            display: flex;
            align-items: center;
            gap: 6px;
        }
        
        .live-badge-dot {
            width: 7px;
            height: 7px;
            background: #a000ff;
            border-radius: 50%;
            animation: pulse 2s ease-in-out infinite;
        }
        
        .info-text {
            width: 100%;
            text-align: center;
            margin: 0;
            padding: 10px 30px;
            font-size: 10px;
            color: #888;
            background: #0f0f0f;
            line-height: 1.4;
        }
        
        .channels-section {
            flex: 1;
            background: #0f0f0f;
            overflow-y: auto;
            padding: 0;
        }
        
        .channels-list {
            padding: 8px 0;
        }
        
        .channel-item {
            display: flex;
            padding: 8px 16px;
            cursor: pointer;
            transition: background 0.2s;
            gap: 12px;
            align-items: flex-start;
            border-left: 3px solid transparent;
        }
        
        .channel-item:hover {
            background: #272727;
        }
        
        .channel-item.active {
            background: #272727;
            border-left-color: #a000ff;
        }
        
        .channel-thumbnail {
            width: 120px;
            height: 70px;
            border-radius: 8px;
            background: linear-gradient(135deg, #a000ff, #2d5bff);
            flex-shrink: 0;
            position: relative;
            overflow: hidden;
        }
        
        .channel-thumbnail img {
            width: 100%;
            height: 100%;
            object-fit: contain;
            padding: 6px;
        }
        
        .channel-thumbnail::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            opacity: 0.1;
        }
        
        .thumbnail-placeholder {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 32px;
            font-weight: 700;
            color: #a000ff;
        }
        
        .channel-info {
            flex: 1;
            min-width: 0;
            padding-top: 2px;
        }
        
        .channel-name {
            font-size: 14px;
            font-weight: 500;
            color: #f1f1f1;
            margin-bottom: 4px;
            overflow: hidden;
            text-overflow: ellipsis;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            line-height: 1.4;
        }
        
        .channel-meta {
            display: flex;
            flex-direction: column;
            gap: 4px;
            margin-top: 4px;
        }
        
        .channel-category {
            font-size: 12px;
            color: #aaa;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }
        
        .live-indicator {
            display: flex;
            align-items: center;
            gap: 4px;
            font-size: 11px;
            color: #aaa;
        }
        
        .live-dot {
            width: 6px;
            height: 6px;
            background: #a000ff;
            border-radius: 50%;
            animation: pulse 2s ease-in-out infinite;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.6; transform: scale(0.8); }
        }
        
        .loading-screen {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: #000;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 2;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s ease;
        }
        
        .loading-screen.show {
            opacity: 1;
            pointer-events: all;
        }
        
        .spinner {
            width: 48px;
            height: 48px;
            border: 3px solid rgba(255,255,255,0.1);
            border-top-color: #a000ff;
            border-right-color: #2d5bff;
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        .loading, .error {
            text-align: center;
            padding: 32px 16px;
            color: #aaa;
            font-size: 14px;
        }
        
        .error {
            color: #a000ff;
        }

        /* ===== TELA DE ERRO NO PLAYER ===== */
        .player-error-screen {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: #000;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 5;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.4s ease;
            padding: 20px;
            text-align: center;
        }

        .player-error-screen.show {
            opacity: 1;
            pointer-events: all;
        }

        .player-error-icon {
            font-size: 40px;
            margin-bottom: 12px;
            line-height: 1;
        }

        .player-error-title {
            font-size: 15px;
            font-weight: 600;
            color: #f1f1f1;
            margin-bottom: 6px;
            line-height: 1.4;
        }

        .player-error-subtitle {
            font-size: 12px;
            color: #888;
            margin-bottom: 18px;
            line-height: 1.5;
            max-width: 260px;
        }

        .player-error-btn {
            background: linear-gradient(135deg, #a000ff, #2d5bff);
            color: #fff;
            border: none;
            padding: 10px 28px;
            border-radius: 6px;
            font-size: 13px;
            font-weight: 600;
            cursor: pointer;
            transition: opacity 0.2s, transform 0.1s;
            letter-spacing: 0.3px;
        }

        .player-error-btn:hover {
            opacity: 0.85;
        }

        .player-error-btn:active {
            transform: scale(0.96);
        }

        /* Variante "canal indispon√≠vel" ‚Äî √≠cone e bot√£o diferentes */
        .player-error-screen.unavailable .player-error-icon {
            opacity: 0.5;
        }

        .player-error-screen.unavailable .player-error-btn {
            background: #333;
            color: #ccc;
        }

        .player-error-screen.unavailable .player-error-btn:hover {
            background: #444;
        }
        
        ::-webkit-scrollbar {
            width: 8px;
        }
        
        ::-webkit-scrollbar-track {
            background: #0f0f0f;
        }
        
        ::-webkit-scrollbar-thumb {
            background: #3f3f3f;
            border-radius: 4px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: #5f5f5f;
        }

        .player-container.fullscreen {
            position: fixed !important;
            top: 0 !important;
            left: 0 !important;
            width: 100vw !important;
            height: 100vh !important;
            height: 100dvh !important;
            z-index: 999999 !important;
        }

        .player-container.fullscreen .video-wrapper {
            padding-top: 0 !important;
            width: 100% !important;
            height: 100% !important;
        }
        
        .player-container.fullscreen .channels-section {
            display: none !important;
        }
        
        .player-container.fullscreen .progress-divider {
            display: none !important;
        }
        
        .player-container.fullscreen .info-text {
            display: none !important;
        }
        
        html:fullscreen,
        html:-webkit-full-screen,
        html:-moz-full-screen,
        html:-ms-fullscreen {
            width: 100vw !important;
            height: 100vh !important;
            height: 100dvh !important;
            overflow: hidden !important;
            margin: 0 !important;
            padding: 0 !important;
        }
        
        body:fullscreen,
        body:-webkit-full-screen,
        body:-moz-full-screen,
        body:-ms-fullscreen {
            width: 100vw !important;
            height: 100vh !important;
            height: 100dvh !important;
            overflow: hidden !important;
            margin: 0 !important;
            padding: 0 !important;
        }
        
        :fullscreen {
            width: 100vw !important;
            height: 100vh !important;
            height: 100dvh !important;
            overflow: hidden !important;
        }
        
        :-webkit-full-screen {
            width: 100vw !important;
            height: 100vh !important;
            height: 100dvh !important;
            overflow: hidden !important;
        }
        
        :-moz-full-screen {
            width: 100vw !important;
            height: 100vh !important;
            height: 100dvh !important;
            overflow: hidden !important;
        }
        
        :-ms-fullscreen {
            width: 100vw !important;
            height: 100vh !important;
            height: 100dvh !important;
            overflow: hidden !important;
        }
        
        .browser-block {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: #0f0f0f;
            z-index: 9999;
            display: none;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 32px;
            text-align: center;
        }
        
        .browser-block.show {
            display: flex;
        }
        
        .browser-block-logo {
            width: 100px;
            height: 100px;
            margin-bottom: 24px;
            object-fit: contain;
        }
        
        .browser-block-title {
            font-size: 24px;
            font-weight: 600;
            color: #f1f1f1;
            margin-bottom: 16px;
        }
        
        .browser-block-message {
            font-size: 16px;
            color: #aaa;
            line-height: 1.6;
            margin-bottom: 32px;
            max-width: 400px;
        }
        
        .browser-block-btn {
            background: #0066ff;
            color: white;
            border: none;
            padding: 16px 48px;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            text-decoration: none;
            display: inline-block;
            transition: background 0.3s;
        }
        
        .browser-block-btn:hover {
            background: #0052cc;
        }
        
        .browser-block-btn:active {
            transform: scale(0.98);
        }
        
        .rotation-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.95);
            z-index: 10000;
            display: none;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            color: white;
        }
        
        .rotation-overlay.show {
            display: flex;
        }
        
        .rotation-icon {
            font-size: 64px;
            margin-bottom: 24px;
            animation: rotate-hint 2s ease-in-out infinite;
        }
        
        @keyframes rotate-hint {
            0%, 100% { transform: rotate(0deg); }
            25% { transform: rotate(-15deg); }
            75% { transform: rotate(15deg); }
        }
        
        .rotation-text {
            font-size: 18px;
            text-align: center;
            padding: 0 32px;
            line-height: 1.6;
        }
    </style>
</head>
<body>
    <!-- Tela de Bloqueio de Navegador -->
    <div class="browser-block" id="browser-block">
        <img src="https://raw.githubusercontent.com/vittopayver/tv/refs/heads/main/img/internet.png" alt="G-Hub TV" class="browser-block-logo">
        <div class="browser-block-title">HeyTap Browser</div>
        <div class="browser-block-message">
            Para assistir √† G-Hub TV, voc√™ precisa usar o navegador HeyTap. 
            Baixe o aplicativo oficial caso n√£o tenha no seu dispositivo.
        </div>
        <a href="https://play.google.com/store/apps/details?id=com.heytap.browser" class="browser-block-btn" target="_blank">
            Baixar Agora 
        </a>
    </div>
    
    <!-- Overlay de Rota√ß√£o -->
    <div class="rotation-overlay" id="rotation-overlay">
        <div class="rotation-icon">üì±</div>
        <div class="rotation-text">Por favor, rotacione seu dispositivo para o modo paisagem para aproveitar a tela cheia</div>
    </div>
    
    <div class="player-container" id="player-container">
        <!-- Video Wrapper -->
        <div class="video-wrapper" id="video-wrapper">
            <video id="video-player" preload="auto" muted playsinline webkit-playsinline></video>
            
            <!-- Overlay de toque: cobre toda a √°rea do player -->
            <div class="click-overlay" id="click-overlay"></div>
            
            <!-- Header (z-index acima do overlay) -->
            <div class="video-header" id="video-header">
                <div class="video-title" id="video-title">Carregando...</div>
                <button class="chat-btn" id="chat-btn">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>
                    </svg>
                </button>
            </div>
            
            <!-- Controls (z-index acima do overlay) -->
            <div class="video-controls" id="video-controls">
                <div class="controls-row">
                    <div class="live-badge">
                        <div class="live-badge-dot"></div>
                        G-Hub Tv
                    </div>
                    <div class="spacer"></div>
                    <button class="control-btn" id="fullscreen-btn">‚õ∂</button>
                </div>
            </div>
            
            <div class="loading-screen" id="loading-screen">
                <div class="spinner"></div>
            </div>

            <!-- Tela de Erro: Tente novamente -->
            <div class="player-error-screen" id="player-error-retry">
                <div class="player-error-icon">‚ö†Ô∏è</div>
                <div class="player-error-title">N√£o foi poss√≠vel reproduzir</div>
                <div class="player-error-subtitle">Toque no bot√£o abaixo ou clique no canal novamente para tentar uma nova conex√£o.</div>
                <button class="player-error-btn" id="player-retry-btn">Tentar novamente</button>
            </div>

            <!-- Tela de Erro: Canal indispon√≠vel -->
            <div class="player-error-screen unavailable" id="player-error-unavailable">
                <div class="player-error-icon">üì°</div>
                <div class="player-error-title">Canal indispon√≠vel no momento</div>
                <div class="player-error-subtitle">Este canal est√° temporariamente fora do ar. Tente outro canal ou volte mais tarde.</div>
                <button class="player-error-btn" id="player-unavailable-btn">Escolher outro canal</button>
            </div>

            <!-- Barra Divis√≥ria com Progresso -->
            <div class="progress-divider" id="progress-divider">
                <div class="progress-divider-fill" id="progress-divider-fill"></div>
                <div class="progress-divider-ball" id="progress-divider-ball"></div>
            </div>
        </div>
        
        <!-- Texto Informativo -->
        <div class="info-text">
De filmes a jogos, o G-Hub TV oferece divers√£o gratuita para toda a fam√≠lia, com canais sempre atualizados.        </div>
        
        <!-- Channels Section -->
        <div class="channels-section" id="channels-section">
            <div class="channels-list" id="channels-list">
                <div class="loading">Carregando canais...</div>
            </div>
        </div>
    </div>
    
    <!-- Gaveta do Chat -->
    <div class="chat-drawer" id="chat-drawer">
        <div class="chat-header" id="chat-header">
            <div class="chat-title">Chat ao vivo</div>
            <button class="chat-close-btn" id="chat-close-btn">√ó</button>
        </div>
        <div class="chat-content">
            <div class="chat-unavailable">
                <div class="chat-unavailable-title">Chat n√£o dispon√≠vel</div>
                <div class="chat-unavailable-text">O chat ao vivo n√£o est√° dispon√≠vel para este canal</div>
            </div>
        </div>
    </div>

    <script>
        // ===== REDIRECIONAMENTO PARA TV/DESKTOP =====
        (function() {
            // Link para TV/Desktop
            const TV_DESKTOP_LINK = 'https://vittopayver.github.io/tv/desktop/';
            
            // Detectar dispositivo
            function detectDevice() {
                const userAgent = navigator.userAgent || navigator.vendor || window.opera;
                
                // Padr√µes para dispositivos m√≥veis
                const mobilePatterns = [
                    /Android/i,
                    /webOS/i,
                    /iPhone/i,
                    /iPad/i,
                    /iPod/i,
                    /BlackBerry/i,
                    /IEMobile/i,
                    /Opera Mini/i,
                    /Windows Phone/i,
                    /Mobile/i,
                    /Tablet/i
                ];
                
                // Padr√µes para TVs
                const tvPatterns = [
                    /SmartTV/i,
                    /TV/i,
                    /AppleTV/i,
                    /GoogleTV/i,
                    /Roku/i,
                    /PlayStation/i,
                    /Xbox/i,
                    /Tizen/i,
                    /Web0S/i,
                    /NetCast/i
                ];
                
                const isMobile = mobilePatterns.some(pattern => pattern.test(userAgent));
                const isTV = tvPatterns.some(pattern => pattern.test(userAgent));
                
                return { isMobile, isTV };
            }
            
            const { isMobile, isTV } = detectDevice();
            
            // Se for TV ou Desktop (n√£o mobile), redireciona IMEDIATAMENTE
            if (isTV || !isMobile) {
                window.location.href = TV_DESKTOP_LINK;
                return; // Interrompe a execu√ß√£o do resto do c√≥digo
            }
            
            // Se chegou aqui, √© mobile - continua com o c√≥digo normal
            
            // ===== PROTE√á√ÉO CONTRA INSPE√á√ÉO =====
            (function() {
                'use strict';
                
                const devtoolsDetector = () => {
                    const threshold = 160;
                    const widthThreshold = window.outerWidth - window.innerWidth > threshold;
                    const heightThreshold = window.outerHeight - window.innerHeight > threshold;
                    
                    if (widthThreshold || heightThreshold) {
                        window.location.reload();
                    }
                };
                
                document.addEventListener('contextmenu', e => e.preventDefault());
                
                document.addEventListener('keydown', e => {
                    if (e.keyCode === 123) {
                        e.preventDefault();
                        return false;
                    }
                    if (e.ctrlKey && e.shiftKey && (e.keyCode === 73 || e.keyCode === 74)) {
                        e.preventDefault();
                        return false;
                    }
                    if (e.ctrlKey && e.keyCode === 85) {
                        e.preventDefault();
                        return false;
                    }
                    if (e.ctrlKey && e.keyCode === 83) {
                        e.preventDefault();
                        return false;
                    }
                });
                
                setInterval(devtoolsDetector, 1000);
                
                document.onselectstart = () => false;
                document.oncopy = () => false;
            })();
            
            document.addEventListener('DOMContentLoaded', function() {
                // ===== DETEC√á√ÉO E APLICA√á√ÉO DO TEMA DO NAVEGADOR =====
                function applyTheme() {
                    const prefersDarkScheme = window.matchMedia('(prefers-color-scheme: dark)');
                    const prefersLightScheme = window.matchMedia('(prefers-color-scheme: light)');
                    
                    if (prefersLightScheme.matches) {
                        document.body.classList.add('light-theme');
                    } else if (prefersDarkScheme.matches) {
                        document.body.classList.remove('light-theme');
                    } else {
                        document.body.classList.remove('light-theme');
                    }
                }
                
                applyTheme();
                
                window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', function(e) {
                    if (e.matches) {
                        document.body.classList.remove('light-theme');
                    } else {
                        document.body.classList.add('light-theme');
                    }
                });
                
                window.matchMedia('(prefers-color-scheme: light)').addEventListener('change', function(e) {
                    if (e.matches) {
                        document.body.classList.add('light-theme');
                    } else {
                        document.body.classList.remove('light-theme');
                    }
                });
                
                // ===== DETEC√á√ÉO DE NAVEGADOR =====
                function isHeyTapBrowser() {
                    const userAgent = navigator.userAgent.toLowerCase();
                    return userAgent.includes('heytapbrowser') || 
                           userAgent.includes('heytap') ||
                           userAgent.includes('oppo');
                }
                
                if (!isHeyTapBrowser()) {
                    document.getElementById('browser-block').classList.add('show');
                    document.getElementById('player-container').style.display = 'none';
                    return;
                }
                
                const videoPlayer = document.getElementById('video-player');
                const playerContainer = document.getElementById('player-container');
                const videoWrapper = document.getElementById('video-wrapper');
                const channelsList = document.getElementById('channels-list');
                const clickOverlay = document.getElementById('click-overlay');
                const loadingScreen = document.getElementById('loading-screen');
                const videoHeader = document.getElementById('video-header');
                const videoTitle = document.getElementById('video-title');
                const videoControls = document.getElementById('video-controls');
                const fullscreenBtn = document.getElementById('fullscreen-btn');
                const progressDividerFill = document.getElementById('progress-divider-fill');
                const progressDividerBall = document.getElementById('progress-divider-ball');
                const chatBtn = document.getElementById('chat-btn');
                const chatDrawer = document.getElementById('chat-drawer');
                const chatHeader = document.getElementById('chat-header');
                const chatCloseBtn = document.getElementById('chat-close-btn');
                const rotationOverlay = document.getElementById('rotation-overlay');

                // Refer√™ncias das telas de erro
                const playerErrorRetry = document.getElementById('player-error-retry');
                const playerErrorUnavailable = document.getElementById('player-error-unavailable');
                const playerRetryBtn = document.getElementById('player-retry-btn');
                const playerUnavailableBtn = document.getElementById('player-unavailable-btn');
                
                const playlistUrl = atob('aHR0cHM6Ly9yYXcuZ2l0aHVidXNlcmNvbnRlbnQuY29tL3ZpdHRvcGF5dmVyL3R2L3JlZnMvaGVhZHMvbWFpbi9saXN0YS5tM3U4');
                
                let channels = [];
                let currentChannelIndex = -1;
                let controlsVisible = false;
                let hideControlsTimeout = null;
                let isFullscreen = false;
                let isLandscape = false;

                // ===== CONTROLE DE ERROS =====
                // errorCount: quantas falhas consecutivas ocorreram no canal atual
                let errorCount = 0;

                function hideAllErrorScreens() {
                    playerErrorRetry.classList.remove('show');
                    playerErrorUnavailable.classList.remove('show');
                }

                function showRetryScreen() {
                    loadingScreen.classList.remove('show');
                    hideAllErrorScreens();
                    playerErrorRetry.classList.add('show');
                }

                function showUnavailableScreen() {
                    loadingScreen.classList.remove('show');
                    hideAllErrorScreens();
                    playerErrorUnavailable.classList.add('show');
                }

                // Bot√£o "Tentar novamente" ‚Äî recarrega o canal atual
                playerRetryBtn.addEventListener('click', function(e) {
                    e.stopPropagation();
                    if (currentChannelIndex >= 0) {
                        playChannel(currentChannelIndex, true);
                    }
                });

                // Bot√£o "Escolher outro canal" ‚Äî fecha a tela e rola a lista para o topo
                playerUnavailableBtn.addEventListener('click', function(e) {
                    e.stopPropagation();
                    hideAllErrorScreens();
                    document.getElementById('channels-section').scrollTo({ top: 0, behavior: 'smooth' });
                });

                // ===== CONTROLE DO BOT√ÉO VOLTAR =====
                let backHandlerActive = false;

                function activateBackHandler() {
                    if (backHandlerActive) return;
                    backHandlerActive = true;
                    window.history.pushState({ appState: true }, '');
                }

                function deactivateBackHandler() {
                    backHandlerActive = false;
                }

                window.addEventListener('popstate', async function(e) {
                    if (!e.state || !e.state.appState) {
                        deactivateBackHandler();
                        return;
                    }

                    if (isFullscreen) {
                        await exitFullscreen();
                        enableKeepScreenOn();
                        if (chatDrawer.classList.contains('open')) {
                            activateBackHandler();
                        }
                        return;
                    }

                    if (chatDrawer.classList.contains('open')) {
                        closeChat();
                        return;
                    }

                    deactivateBackHandler();
                    window.history.back();
                });
                
                const urlProxy = new Map();
                let urlCounter = 0;
                
                const obfuscateUrl = (url) => {
                    const token = `__vid_${urlCounter++}_${Math.random().toString(36).substr(2, 9)}`;
                    urlProxy.set(token, url);
                    return token;
                };
                
                const deobfuscateUrl = (token) => {
                    return urlProxy.get(token) || '';
                };
                
                const originalSrcDescriptor = Object.getOwnPropertyDescriptor(HTMLMediaElement.prototype, 'src');
                Object.defineProperty(videoPlayer, 'src', {
                    get: function() {
                        return '[PROTECTED]';
                    },
                    set: function(value) {
                        if (value.startsWith('__vid_')) {
                            const realUrl = deobfuscateUrl(value);
                            originalSrcDescriptor.set.call(this, realUrl);
                        } else {
                            originalSrcDescriptor.set.call(this, value);
                        }
                    },
                    configurable: false
                });
                
                Object.defineProperty(videoPlayer, 'currentSrc', {
                    get: function() {
                        return '[PROTECTED]';
                    },
                    configurable: false
                });

                // ===== BLOQUEIO DE ESCURECIMENTO =====
                let wakeLock = null;
                let screenKeepAliveInterval = null;
                let noSleepVideo = null;

                async function tryWakeLockAPI() {
                    try {
                        if ('wakeLock' in navigator && document.visibilityState === 'visible') {
                            if (wakeLock && !wakeLock.released) return true;
                            wakeLock = await navigator.wakeLock.request('screen');
                            wakeLock.addEventListener('release', () => {
                                wakeLock = null;
                                if (document.visibilityState === 'visible') {
                                    setTimeout(tryWakeLockAPI, 200);
                                }
                            });
                            return true;
                        }
                    } catch (err) {}
                    return false;
                }

                function startNoSleepVideo() {
                    if (noSleepVideo) return;
                    noSleepVideo = document.createElement('video');
                    noSleepVideo.setAttribute('playsinline', '');
                    noSleepVideo.setAttribute('webkit-playsinline', '');
                    noSleepVideo.setAttribute('muted', '');
                    noSleepVideo.muted = true;
                    noSleepVideo.loop = true;
                    noSleepVideo.style.cssText = 'position:fixed;top:-1px;left:-1px;width:1px;height:1px;opacity:0.001;pointer-events:none;z-index:-1;';
                    const mp4 = 'data:video/mp4;base64,AAAAIGZ0eXBpc29tAAACAGlzb21pc28ybXA0MQAAAAhmcmVlAAAA/21kYXQAAAA=';
                    const webm = 'data:video/webm;base64,GkXfowEAAAAAAAAfQoaBAUL3gQFC8oEEQvOBCEKChHdlYm1Ch4ECQoWBAhhTgGcBAAAAAAAVkhFNm3RALE27i1OrhBVJqWZTrIHfTbuMU6uEFlSua1OsggEwTbuMU6uEHFO7a1OsggI27AEAAAAAAABZAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAVSalmAAAAAAAEAAAABgIBIwAA';
                    const source1 = document.createElement('source');
                    source1.src = mp4;
                    source1.type = 'video/mp4';
                    const source2 = document.createElement('source');
                    source2.src = webm;
                    source2.type = 'video/webm';
                    noSleepVideo.appendChild(source1);
                    noSleepVideo.appendChild(source2);
                    document.body.appendChild(noSleepVideo);
                    noSleepVideo.play().catch(() => {});
                }

                function stopNoSleepVideo() {
                    if (noSleepVideo) {
                        noSleepVideo.pause();
                        noSleepVideo.remove();
                        noSleepVideo = null;
                    }
                }

                function startScreenActivity() {
                    if (screenKeepAliveInterval) return;
                    const ghost = document.createElement('div');
                    ghost.style.cssText = 'position:fixed;top:0;left:0;width:1px;height:1px;opacity:0;pointer-events:none;z-index:-999;';
                    document.body.appendChild(ghost);
                    let tick = 0;
                    screenKeepAliveInterval = setInterval(() => {
                        ghost.style.transform = `translateX(${tick % 2}px)`;
                        tick++;
                    }, 20000);
                }

                function stopScreenActivity() {
                    if (screenKeepAliveInterval) {
                        clearInterval(screenKeepAliveInterval);
                        screenKeepAliveInterval = null;
                    }
                }

                async function enableKeepScreenOn() {
                    await tryWakeLockAPI();
                    startNoSleepVideo();
                    startScreenActivity();
                }

                async function forceWakeLock() {
                    if (wakeLock && !wakeLock.released) {
                        try { await wakeLock.release(); } catch (_) {}
                        wakeLock = null;
                    }
                    await enableKeepScreenOn();
                }

                async function releaseWakeLock() {
                    stopScreenActivity();
                    stopNoSleepVideo();
                    if (wakeLock && !wakeLock.released) {
                        try { await wakeLock.release(); } catch (_) {}
                    }
                    wakeLock = null;
                }

                enableKeepScreenOn();

                document.addEventListener('visibilitychange', async () => {
                    if (document.visibilityState === 'visible') {
                        await enableKeepScreenOn();
                        if (videoPlayer && videoPlayer.paused && currentChannelIndex >= 0) {
                            videoPlayer.play().catch(err => console.log('Autoplay bloqueado'));
                        }
                        if (isFullscreen) {
                            hideAddressBar();
                        }
                    }
                });

                document.addEventListener('touchstart', () => {
                    if (document.visibilityState === 'visible') {
                        enableKeepScreenOn();
                    }
                }, { passive: true });
                
                // ===== FUNCIONALIDADE DO CHAT =====
                let isDragging = false;
                let startY = 0;
                let currentY = 0;
                let drawerHeight = 0;
                let isExpanded = false;
                
                function openChat() {
                    chatDrawer.classList.add('open');
                    activateBackHandler();
                }
                
                function closeChat() {
                    chatDrawer.classList.remove('open');
                    setTimeout(() => {
                        chatDrawer.style.height = '56vh';
                        chatDrawer.classList.remove('expanded');
                        isExpanded = false;
                        chatDrawer.style.transition = 'transform 0.3s ease, height 0.3s ease';
                    }, 300);
                }
                
                chatBtn.addEventListener('click', function(e) {
                    e.stopPropagation();
                    openChat();
                });
                
                chatCloseBtn.addEventListener('click', function(e) {
                    e.stopPropagation();
                    closeChat();
                });
                
                chatHeader.addEventListener('touchstart', function(e) {
                    if (!chatDrawer.classList.contains('open')) return;
                    isDragging = true;
                    startY = e.touches[0].clientY;
                    drawerHeight = chatDrawer.offsetHeight;
                    chatDrawer.style.transition = 'none';
                }, { passive: true });
                
                chatHeader.addEventListener('touchmove', function(e) {
                    if (!isDragging) return;
                    currentY = e.touches[0].clientY;
                    const deltaY = startY - currentY;
                    if (deltaY > 0) {
                        const newHeight = Math.min(window.innerHeight - 90, drawerHeight + deltaY);
                        chatDrawer.style.height = newHeight + 'px';
                        if (newHeight >= window.innerHeight - 100) {
                            chatDrawer.classList.add('expanded');
                            isExpanded = true;
                        }
                    } else {
                        const newHeight = Math.max(window.innerHeight * 0.55, drawerHeight + deltaY);
                        chatDrawer.style.height = newHeight + 'px';
                        chatDrawer.classList.remove('expanded');
                        isExpanded = false;
                    }
                }, { passive: true });
                
                chatHeader.addEventListener('touchend', function(e) {
                    if (!isDragging) return;
                    isDragging = false;
                    chatDrawer.style.transition = 'transform 0.3s ease, height 0.3s ease';
                    const finalY = currentY;
                    const deltaY = startY - finalY;
                    if (deltaY < -100) {
                        closeChat();
                    } else if (deltaY > 200 || isExpanded) {
                        chatDrawer.style.height = 'calc(100vh - 90px)';
                        chatDrawer.classList.add('expanded');
                        isExpanded = true;
                    } else {
                        chatDrawer.style.height = '56vh';
                        chatDrawer.classList.remove('expanded');
                        isExpanded = false;
                    }
                });
                
                // ===== DETEC√á√ÉO DE ORIENTA√á√ÉO =====
                function checkOrientation() {
                    const orientation = window.innerWidth > window.innerHeight ? 'landscape' : 'portrait';
                    isLandscape = orientation === 'landscape';
                    return orientation;
                }
                
                // ===== FUN√á√ÉO PARA ESCONDER BARRAS DO NAVEGADOR =====
                function hideAddressBar() {
                    window.scrollTo(0, 1);
                    document.body.focus();
                    setTimeout(() => {
                        window.scrollTo(0, 0);
                    }, 50);
                    if (window.visualViewport) {
                        const viewport = window.visualViewport;
                        window.scrollTo(0, Math.max(0, viewport.offsetTop));
                    }
                }
                
                // ===== FULLSCREEN =====
                async function enterFullscreen() {
                    try {
                        isFullscreen = true;
                        playerContainer.classList.add('fullscreen');

                        activateBackHandler();

                        await forceWakeLock();
                        setTimeout(enableKeepScreenOn, 600);
                        setTimeout(enableKeepScreenOn, 1500);
                        
                        const currentOrientation = checkOrientation();
                        if (currentOrientation === 'portrait') {
                            rotationOverlay.classList.add('show');
                        }
                        
                        const elem = document.documentElement;
                        let fullscreenSuccess = false;
                        
                        try {
                            if (elem.requestFullscreen) {
                                await elem.requestFullscreen({ navigationUI: "hide" });
                                fullscreenSuccess = true;
                            }
                        } catch (err) {}
                        
                        if (!fullscreenSuccess) {
                            try {
                                if (elem.webkitRequestFullscreen) {
                                    await elem.webkitRequestFullscreen();
                                    fullscreenSuccess = true;
                                }
                            } catch (err) {}
                        }
                        
                        if (!fullscreenSuccess) {
                            try {
                                if (elem.webkitEnterFullscreen) {
                                    elem.webkitEnterFullscreen();
                                    fullscreenSuccess = true;
                                }
                            } catch (err) {}
                        }
                        
                        if (!fullscreenSuccess) {
                            try {
                                if (elem.mozRequestFullScreen) {
                                    await elem.mozRequestFullScreen();
                                    fullscreenSuccess = true;
                                }
                            } catch (err) {}
                        }
                        
                        if (!fullscreenSuccess) {
                            try {
                                if (elem.msRequestFullscreen) {
                                    await elem.msRequestFullscreen();
                                    fullscreenSuccess = true;
                                }
                            } catch (err) {}
                        }
                        
                        hideAddressBar();
                        setTimeout(hideAddressBar, 100);
                        setTimeout(hideAddressBar, 300);
                        setTimeout(hideAddressBar, 500);
                        setTimeout(hideAddressBar, 1000);
                        
                        if (screen.orientation && screen.orientation.lock) {
                            const lockAttempts = ['landscape', 'landscape-primary', 'landscape-secondary'];
                            for (const orientation of lockAttempts) {
                                try {
                                    await screen.orientation.lock(orientation);
                                    rotationOverlay.classList.remove('show');
                                    break;
                                } catch (err) {}
                            }
                        }
                        
                    } catch (err) {
                        rotationOverlay.classList.remove('show');
                    }
                }
                
                // ===== SAIR DO FULLSCREEN =====
                function exitFullscreenSync() {
                    videoWrapper.classList.add('transitioning');

                    isFullscreen = false;
                    playerContainer.classList.remove('fullscreen');
                    rotationOverlay.classList.remove('show');
                    deactivateBackHandler();

                    if (screen.orientation && screen.orientation.unlock) {
                        try { screen.orientation.unlock(); } catch (_) {}
                    }

                    const revealOnChange = () => {
                        requestAnimationFrame(() => {
                            videoWrapper.classList.remove('transitioning');
                            enableKeepScreenOn();
                        });
                        document.removeEventListener('fullscreenchange', revealOnChange);
                        document.removeEventListener('webkitfullscreenchange', revealOnChange);
                    };

                    document.addEventListener('fullscreenchange', revealOnChange);
                    document.addEventListener('webkitfullscreenchange', revealOnChange);

                    if (document.fullscreenElement) {
                        document.exitFullscreen().catch(() => {
                            setTimeout(() => videoWrapper.classList.remove('transitioning'), 150);
                        });
                    } else if (document.webkitFullscreenElement) {
                        document.webkitExitFullscreen();
                    } else {
                        document.removeEventListener('fullscreenchange', revealOnChange);
                        document.removeEventListener('webkitfullscreenchange', revealOnChange);
                        requestAnimationFrame(() => {
                            requestAnimationFrame(() => {
                                videoWrapper.classList.remove('transitioning');
                                enableKeepScreenOn();
                            });
                        });
                    }
                }

                async function exitFullscreen() {
                    exitFullscreenSync();
                }
                
                fullscreenBtn.addEventListener('click', function(e) {
                    e.stopPropagation();
                    if (!isFullscreen) {
                        enterFullscreen();
                    } else {
                        exitFullscreenSync();
                    }
                });
                
                window.addEventListener('orientationchange', function() {
                    const newOrientation = checkOrientation();
                    if (isFullscreen && newOrientation === 'landscape') {
                        rotationOverlay.classList.remove('show');
                    }
                    if (isFullscreen) hideAddressBar();
                });
                
                window.addEventListener('resize', function() {
                    const newOrientation = checkOrientation();
                    if (isFullscreen && newOrientation === 'landscape') {
                        rotationOverlay.classList.remove('show');
                    }
                    if (isFullscreen) hideAddressBar();
                });
                
                // ===== EVENTOS DE FULLSCREEN =====
                function onFullscreenChange() {
                    const isNowFullscreen = !!(
                        document.fullscreenElement ||
                        document.webkitFullscreenElement ||
                        document.mozFullScreenElement ||
                        document.msFullscreenElement
                    );

                    if (!isNowFullscreen && isFullscreen) {
                        isFullscreen = false;
                        playerContainer.classList.remove('fullscreen');
                        rotationOverlay.classList.remove('show');
                        deactivateBackHandler();
                        if (screen.orientation && screen.orientation.unlock) {
                            try { screen.orientation.unlock(); } catch (_) {}
                        }
                        enableKeepScreenOn();
                    } else if (isNowFullscreen) {
                        hideAddressBar();
                        enableKeepScreenOn();
                    }
                }
                
                document.addEventListener('fullscreenchange', onFullscreenChange);
                document.addEventListener('webkitfullscreenchange', onFullscreenChange);
                document.addEventListener('mozfullscreenchange', onFullscreenChange);
                document.addEventListener('MSFullscreenChange', onFullscreenChange);
                
                // Progress Bar
                videoPlayer.addEventListener('timeupdate', function() {
                    if (videoPlayer.duration && isFinite(videoPlayer.duration)) {
                        const progress = (videoPlayer.currentTime / videoPlayer.duration) * 100;
                        progressDividerFill.style.width = progress + '%';
                    }
                });
                
                // ===== CONTROLES =====
                function showControls() {
                    controlsVisible = true;
                    videoHeader.classList.add('show');
                    videoControls.classList.add('show');
                    
                    if (hideControlsTimeout) {
                        clearTimeout(hideControlsTimeout);
                    }
                    
                    hideControlsTimeout = setTimeout(() => {
                        hideControls();
                    }, 3000);
                }
                
                function hideControls() {
                    controlsVisible = false;
                    videoHeader.classList.remove('show');
                    videoControls.classList.remove('show');
                }
                
                clickOverlay.addEventListener('click', function(e) {
                    if (chatDrawer.classList.contains('open')) {
                        closeChat();
                        return;
                    }
                    if (controlsVisible) {
                        hideControls();
                    } else {
                        showControls();
                    }
                });

                clickOverlay.addEventListener('touchend', function(e) {
                    e.preventDefault();
                    if (chatDrawer.classList.contains('open')) {
                        closeChat();
                        return;
                    }
                    if (controlsVisible) {
                        hideControls();
                    } else {
                        showControls();
                    }
                }, { passive: false });
                
                // Carregar playlist
                function loadPlaylist(url) {
                    channelsList.innerHTML = '<div class="loading">Carregando canais...</div>';
                    
                    fetch(url)
                        .then(response => {
                            if (!response.ok) throw new Error('Erro ao carregar');
                            return response.text();
                        })
                        .then(data => {
                            parsePlaylist(data);
                        })
                        .catch(error => {
                            channelsList.innerHTML = '<div class="error">Erro ao carregar a playlist</div>';
                        });
                }
                
                function parsePlaylist(data) {
                    const lines = data.split('\n');
                    channels = [];
                    
                    for (let i = 0; i < lines.length; i++) {
                        const line = lines[i].trim();
                        
                        if (line.startsWith('#EXTINF:')) {
                            const info = line.substring(8);
                            const parts = info.split(',');
                            const attributes = parts[0];
                            const name = parts.slice(1).join(',').trim();
                            
                            const url = lines[i + 1] ? lines[i + 1].trim() : '';
                            
                            if (url && !url.startsWith('#')) {
                                let logo = '';
                                const logoMatch = attributes.match(/tvg-logo="([^"]*)"/);
                                if (logoMatch) logo = logoMatch[1];
                                
                                let group = '';
                                const groupMatch = attributes.match(/group-title="([^"]*)"/);
                                if (groupMatch) group = groupMatch[1];
                                
                                const obfuscatedUrl = obfuscateUrl(url);
                                
                                channels.push({
                                    name: name,
                                    url: obfuscatedUrl,
                                    logo: logo,
                                    group: group
                                });
                            }
                        }
                    }
                    
                    renderChannels();
                }
                
                function renderChannels() {
                    if (channels.length === 0) {
                        channelsList.innerHTML = '<div class="error">Nenhum canal encontrado</div>';
                        return;
                    }
                    
                    channelsList.innerHTML = '';
                    
                    channels.forEach((channel, index) => {
                        const channelItem = document.createElement('div');
                        channelItem.className = 'channel-item';
                        channelItem.innerHTML = `
                            <div class="channel-thumbnail">
                                ${channel.logo ? `<img src="${channel.logo}" alt="${channel.name}">` : `<div class="thumbnail-placeholder">${channel.name.charAt(0)}</div>`}
                            </div>
                            <div class="channel-info">
                                <div class="channel-name">${channel.name}</div>
                                <div class="channel-meta">
                                    <div class="live-indicator">
                                        <div class="live-dot"></div>
                                        <span>Ao vivo</span>
                                    </div>
                                    <div class="channel-category">${channel.group || 'Geral'}</div>
                                </div>
                            </div>
                        `;
                        
                        channelItem.addEventListener('click', (e) => {
                            e.stopPropagation();
                            playChannel(index);
                        });
                        
                        channelsList.appendChild(channelItem);
                    });
                    
                    if (channels.length > 0) {
                        playChannel(0);
                    }
                }

                // ===== REPRODU√á√ÉO DO CANAL =====

                // Logica de deteccao de travamento:
                // - Timer SO come√ßa quando o video para ('waiting' ou 'stalled')
                // - 'timeupdate' ou 'playing' CANCELA o timer ‚Äî video esta vivo
                // - Erro so dispara se ficar parado por STALL_LIMIT sem nenhum sinal de vida
                const STALL_LIMIT = 20000; // 20s parado = stream morto
                let _stallTimer = null;

                function _clearStall() {
                    if (_stallTimer) { clearTimeout(_stallTimer); _stallTimer = null; }
                }

                function _triggerError() {
                    _clearStall();
                    _removeStallListeners();
                    loadingScreen.classList.remove('show');
                    errorCount++;
                    if (errorCount === 1) {
                        showRetryScreen();
                    } else {
                        showUnavailableScreen();
                    }
                }

                // Video avancou ou voltou a tocar: cancela contagem de erro
                function _onTimeUpdate() { _clearStall(); }
                function _onPlaying()    { _clearStall(); }

                // Video parou de receber dados: inicia contagem
                // Buffering normal resolve antes dos 20s
                function _onWaiting() {
                    if (!_stallTimer) _stallTimer = setTimeout(_triggerError, STALL_LIMIT);
                }
                function _onStalled() {
                    if (!_stallTimer) _stallTimer = setTimeout(_triggerError, STALL_LIMIT);
                }
                function _onVideoError() { _triggerError(); }

                function _removeStallListeners() {
                    videoPlayer.removeEventListener('timeupdate', _onTimeUpdate);
                    videoPlayer.removeEventListener('playing',   _onPlaying);
                    videoPlayer.removeEventListener('waiting',   _onWaiting);
                    videoPlayer.removeEventListener('stalled',  _onStalled);
                    videoPlayer.removeEventListener('error',    _onVideoError);
                }

                function _attachStallListeners() {
                    _removeStallListeners();
                    videoPlayer.addEventListener('timeupdate', _onTimeUpdate);
                    videoPlayer.addEventListener('playing',   _onPlaying);
                    videoPlayer.addEventListener('waiting',   _onWaiting);
                    videoPlayer.addEventListener('stalled',  _onStalled);
                    videoPlayer.addEventListener('error',    _onVideoError);
                    // Nao inicia timer aqui: so conta quando o video parar
                }

                // isRetry = true quando o usu√°rio clicou em "Tentar novamente"
                function playChannel(index, isRetry) {
                    if (index < 0 || index >= channels.length) return;

                    // Para tudo do canal anterior
                    _clearStall();
                    _removeStallListeners();

                    // Troca de canal ‚Üí zera contador de erros
                    if (!isRetry) errorCount = 0;

                    const channel = channels[index];

                    hideAllErrorScreens();
                    loadingScreen.classList.add('show');
                    document.getElementById('progress-divider').classList.remove('show');

                    document.querySelectorAll('.channel-item').forEach((item, i) => {
                        item.classList.remove('active');
                        if (i === index) item.classList.add('active');
                    });

                    videoTitle.textContent = channel.name;
                    videoPlayer.src = channel.url;
                    videoPlayer.load();

                    const onError = () => {
                        cleanupLoad();
                        _triggerError();
                    };

                    const onCanPlay = () => {
                        cleanupLoad();
                        errorCount = 0;

                        videoPlayer.muted = false;
                        document.getElementById('progress-divider').classList.add('show');
                        videoPlayer.play().catch(() => {});

                        setTimeout(() => {
                            loadingScreen.classList.remove('show');
                            hideAllErrorScreens();
                            showControls();
                            // Ativa vigil√¢ncia cont√≠nua de travamento
                            _attachStallListeners();
                        }, 300);
                    };

                    // Timeout s√≥ para a fase de loading inicial (15 s)
                    const loadTimer = setTimeout(() => {
                        if (loadingScreen.classList.contains('show')) {
                            cleanupLoad();
                            _triggerError();
                        }
                    }, 15000);

                    function cleanupLoad() {
                        clearTimeout(loadTimer);
                        videoPlayer.removeEventListener('canplay', onCanPlay);
                        videoPlayer.removeEventListener('error',   onError);
                    }

                    videoPlayer.addEventListener('canplay', onCanPlay);
                    videoPlayer.addEventListener('error',   onError);

                    currentChannelIndex = index;
                }
                
                checkOrientation();
                loadPlaylist(playlistUrl);
            });
        })();
    </script>
</body>
</html>
